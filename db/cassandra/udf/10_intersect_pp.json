{
  "name": "10_intersect_pp.json",
  "type": "partial-pushdown",
  "datasets": {
    "date_dim": {
      "table_schema": "date_dim",
      "index": "d_date_sk",
      "query": "SELECT * FROM tpc_ds.date_dim WHERE d_year=1999 AND d_dom <=4 ALLOW FILTERING;"
    },
    "store_sales": {
      "table_schema": "store_sales",
      "index": "ss_sold_date_sk",
      "query": "SELECT * FROM tpc_ds.store_sales;"
    },
    "catalog_sales": {
      "table_schema": "catalog_sales",
      "index": "cs_sold_date_sk",
      "query": "SELECT * FROM tpc_ds.catalog_sales  WHERE ss_net_profit>0 ALLOW_FILTERING;"
    }
  },
  "steps": [
    {
      "etl_func": "inner_join",
      "args_tb": {
        "left_tb": "store_sales",
        "right_tb": "date_dim"
      },
      "args": {
        "left_idx": "ss_sold_date_sk",
        "right_idx": "d_date_sk"
      },
      "output": "SS_DD",
      "remove": [
        "store_sales"
      ]
    },
    {
      "etl_func": "inner_join",
      "args_tb": {
        "left_tb": "catalog_sales",
        "right_tb": "date_dim"
      },
      "args": {
        "left_idx": "cs_sold_date_sk",
        "right_idx": "d_date_sk"
      },
      "output": "CS_DD",
      "remove": [
        "catalog_sales",
        "date_dim"
      ]
    },
    {
      "etl_func": "intersect",
      "args_tb": {
        "left_tb": "SS_DD",
        "right_tb": "CS_DD"
      },
      "output": "SS_CS_DD",
      "remove": [
        "SS_DD",
        "CS_DD"
      ]
    },
    {
      "etl_func": "count",
      "args_tb": {
        "tb": "SS_CS_DD"
      },
      "output": "SS_CS_DD_count",
      "remove": [
        "SS_CS_DD"
      ]
    }
  ]
}